<!-- very important links
https://websitesetup.org/bootstrap-tutorial-for-beginners/#include-jquery

for the search/cindx
https://www.w3schools.com/howto/howto_js_filter_table.asp

making nice boxes for tezt
https://code-boxx.com/box-around-text-html/
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Links to bootstrap 5 and also stylesheet -->
    <link rel="stylesheet" href="bootstrap-5.0.2-dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/style.css">

    <!-- add bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <title>Family Dermatology</title>
</head>

<body>
    <!-- Navbar-->
    <nav class="navbar fixed-top navbar-expand-sm bg-dark navbar-dark">
        <div class="container-fluid">
            <a href="index.html" class="navbar-brand">JY_Dermatology</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- buttons on right-side of navbar -->
            <div class="collapse navbar-collapse" id="navmenu">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a href="basics.html" class="nav-link">
                            Basics
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="cindex.html" class="nav-link">
                            Condition Index
                        </a>
                    </li>

                    <li class="nav-item" onclick="clearStorage()">
                        <a href="" class="nav-link">
                            Clear Local Storage
                        </a>
                    </li>
                </ul>
            </div>
        </div>

    </nav>

    <!-- Header is the main container for content, with overlaid background photo -->
    <header class="page-header header container-fluid" style="padding-top: 60px;">
        <div class="overlay"></div>

        <div class="container-fluid features">

            <!-- Button to add CSV file inn
            <label class="custom-file-upload text-center glassbutton" id="csvinputbutton">
                <input id="csv" type="file" placeholder="Please enter CSV">
                <i class="bi bi-filetype-csv"></i>  If you see this message, please get internet and refresh. <i class="bi bi-filetype-csv"></i>
            </label> -->

            <!-- Search bar -->
            <div style="display: inline-block;" class = "searchBar">
                <input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for names or tags.">
            </div>

            <div class="toggleBox" style="display: inline-block">
                <!-- toggle switch for tags -->
                <div style="display: inline-block; padding-right: 1rem; padding-left: 0.5rem;" >
                    <p style="display: inline-block;"><i class="bi bi-tags"></i></p>
                    <label class="imgswitch">                                      
                        <input type="checkbox" checked id="tagSwitch">
                        <span class="slider round"></span>
                    </label>
                </div>            
                <!-- toggle switch for photos -->
                <div style="display: inline-block;padding-right: 1rem;">
                    <p style="display: inline-block;"><i class="bi bi-images"></i></p>
                    <label class="imgswitch">                                      
                        <input type="checkbox" checked id = "photoSwitch">
                        <span class="slider round"></span>
                    </label>
                </div>    
            </div>

            <!-- unfortunately you have to c/p the correct number of rows to accodate the csv length -->
            <div class="myTable-outer">
            <table id="myTable">
                <tr class="tbheader">
                    <th style="width:15%;">Condition</th>
                    <th style="width:45%;" id = "hideMeTag">Tags</th>
                    <th style="width:40%;" id = "hideMe">Image</th>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>                
            </table>
            </div>
        </div>

    </header>


<!-- footer at bottom of page -->
<footer class="page-footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-12">
                <h6 class="text-uppercase font-weight-bold">Contact link    :</h6>
                <p><a  style="text-decoration: none; color:white;" href="https://forms.gle/xFZ4GEqJgycuLs5r7">https://forms.gle/xFZ4GEqJgycuLs5r7</a></p>

            </div>
            <div class="col-lg-4 col-md-4 col-sm-12">
                <h6 class="text-uppercase font-weight-bold">Did you know?</h6>
                <p id="funfact">
                    <br />
                </p>
            </div>
            <div>
                <div class="footer-copyright text-center">Â©2022</div>
</footer>

    <script src="js/myscripts.js"></script>
    <script>
    randomBackground(); 
    populateFunFacts();    
    
    // for hiding images and tags in table, allows toggle switch to work.
    document.addEventListener('DOMContentLoaded', function () {
        //var checkbox = document.querySelector('input[type="checkbox"]');
        var checkbox = document.getElementById('photoSwitch');
        var tagcheckbox = document.getElementById('tagSwitch');
        
        checkbox.addEventListener('change', function () {
            if (checkbox.checked) {
            // do this
            hideCol(false, 2)
            } else {
            // do that
            hideCol(true , 2)
            }
        });

        tagcheckbox.addEventListener('change', function () {
            if (tagcheckbox.checked) {
            // do this
            hideCol(false, 1)
            } else {
            // do that
            hideCol(true , 1)
            }
        });
    });
    
    window.onload =  function () {
        var checkbox = document.getElementById('photoSwitch');
        var tagcheckbox = document.getElementById('tagSwitch');
        if (checkbox.checked) {
            // do this
            hideCol(false, 2)
            } else {
            // do that
            hideCol(true , 2)
        }
        if (tagcheckbox.checked) {
            // do this
            hideCol(false, 1)
            } else {
            // do that
            hideCol(true , 1)
        }

        //remember what is being searched
        myFunction()
    }

    // on load, see if JSON is in local memory. If not, nee to fetch from Github
    // nneeds to run every time the page is reloaded
    // hiderows() should run before loading the JSON
    hideRows(true)     
    const jsonIndex = localStorage.getItem("indexJSON");
    if (jsonIndex != null) {
        populateTable();
        //document.getElementById("csvinputbutton").setAttribute("style", "display: none") // not here as I deleted this button
    }
    // if no loaded yet
    else{
        fetchRawgitCSV();
    }

        /**Just on load for the cindex page, if no csv has been uploaded yet */
        function hideRows(bool) {
            // Declare variables      
            var table, tr, td, i, txtValue;
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");
            
            if(bool){
                for (i = 1; i < tr.length; i++) {                                       
                    td = tr[i].getElementsByTagName("td")[0];  
                    tr[i].style.display = "none";                
                    
                }
            }else{
                for (i = 1; i < tr.length; i++) {                                       
                    td = tr[i].getElementsByTagName("td")[0];  
                    tr[i].style.display = "";                
                    
                }
            }
        }
        
        //populate table with JSON csv data
        function populateTable() {
            const jsonIndex = JSON.parse(localStorage.getItem("indexJSON"));
            if (jsonIndex != null) {
                var table, tr, condName, tgs, i, imgRef;
                table = document.getElementById("myTable");
                tr = table.getElementsByTagName("tr");
                // Loop through all table rows, populate
                for (i = 1; i < tr.length; i++) {
                    condName = tr[i].getElementsByTagName("td")[0];
                    tgs = tr[i].getElementsByTagName("td")[1];
                    imgRef = tr[i].getElementsByTagName("td")[2];

                    // name with link to html file
                    var aTag = document.createElement('a');
                    aTag.setAttribute('href', jsonIndex[i - 1].html);
                    aTag.setAttribute("style", "text-decoration: none; color:white;")
                    aTag.innerText = jsonIndex[i - 1].Name;
                    condName.appendChild(aTag);                 

                    // fill in tags
                    tgs.innerHTML = jsonIndex[i - 1].tags.replaceAll("+","<br>");

                    // img in 3rd col with link to html file
                    var imgTag = document.createElement('a');
                    imgTag.setAttribute('href',jsonIndex[i-1].html);
                    imgTag.innerHTML = '<img src="'+jsonIndex[i-1].imageSrc+'" class = "tableImg"/>';         
                    imgRef.appendChild(imgTag);
                    //imgRef.innerHTML = '<img src="'+jsonIndex[i-1].imageSrc+'" class = "tableImg"/>'
                    
                    
                }
            }
            hideRows(false) 
                       
        }     

    </script>
    <script src="bootstrap-5.0.2-dist/js/bootstrap.min.js"></script>
</body>

</html>

<!-- 
DECRPEIT CODE
// need user input to specify the CSV used. Can't auto locally load CSV bc security 
        // saves JSON string of indexdata into local memory
        /* old function to run that would ask user to input CSV, not used anymore with github
        var fileInput = document.getElementById("csv"),
            readFile = function () {
                var reader = new FileReader();
                reader.onload = function () {
                    var csvString = reader.result;
                    var indexJSON = csvJSON(csvString);

                    //save stringified JSON into local storage
                    localStorage.setItem("indexJSON", indexJSON)
                    populateTable();
                    document.getElementById("csvinputbutton").setAttribute("style", "display: none")
                                                         
                };
                // start reading the file. When it is done, calls the onload event defined above.
                reader.readAsBinaryString(fileInput.files[0]);
            };
        fileInput.addEventListener('change', readFile);
        */

 -->